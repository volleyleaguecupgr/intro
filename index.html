<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volleyball Match Manager - Team Routing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .info-banner {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .info-banner h3 {
            color: #1e40af;
            margin-bottom: 10px;
        }

        .info-banner p {
            color: #1e40af;
            line-height: 1.6;
        }

        .section-title {
            font-size: 24px;
            color: #1e3a8a;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3b82f6;
        }

        .match-form {
            background: #f8fafc;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
            margin-bottom: 30px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #334155;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .team-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .team-section h3 {
            color: #1e3a8a;
            margin-bottom: 15px;
        }

        .color-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-input-group input[type="color"] {
            width: 60px;
            height: 45px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-tertiary {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .teams-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .team-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .team-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.2);
        }

        .team-card.selected {
            border-color: #3b82f6;
            background: #dbeafe;
        }

        .team-card h4 {
            color: #1e3a8a;
            margin-bottom: 5px;
        }

        .team-card p {
            color: #64748b;
            font-size: 12px;
        }

        .match-history {
            margin-top: 40px;
        }

        .match-item {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e2e8f0;
        }

        .match-item h4 {
            color: #1e3a8a;
            margin-bottom: 10px;
        }

        .match-meta {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .match-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .match-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-view {
            background: #3b82f6;
            color: white;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
        }

        .url-display {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .url-display h4 {
            color: #1e3a8a;
            margin-bottom: 10px;
        }

        .url-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            color: #3b82f6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-btn {
            padding: 8px 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏐 Team-Based Match Router</h1>
            <p>Δημιουργήστε αγώνες - Κάθε ομάδα έχει ένα URL που δείχνει το τελευταίο της παιχνίδι</p>
        </div>

        <div class="content">
            <div class="info-banner">
                <h3>💡 Πώς Λειτουργεί</h3>
                <p><strong>Κάθε ομάδα έχει ένα σταθερό URL:</strong></p>
                <p>• <code>/aris</code> → Δείχνει το τελευταίο παιχνίδι του Άρη<br>
                • <code>/panathinaikos</code> → Δείχνει το τελευταίο παιχνίδι του Παναθηναϊκού</p>
                <p><strong>Όταν δημιουργείτε νέο αγώνα:</strong> Το σύστημα ενημερώνει αυτόματα τα URLs των δύο ομάδων!</p>
            </div>

            <div class="section-title">Δημιουργία Νέου Αγώνα</div>

            <form id="matchForm">
                <div class="match-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ημερομηνία Αγώνα *</label>
                            <input type="date" id="matchDate" required>
                        </div>
                        <div class="form-group">
                            <label>Πρωτάθλημα *</label>
                            <input type="text" id="league" value="VOLLEY LEAGUE" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="team-section">
                            <h3>🏠 Γηπεδούχος</h3>
                            <div class="form-group">
                                <label>Ομάδα *</label>
                                <select id="homeTeam" required>
                                    <option value="">Επιλέξτε ομάδα...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Υπότιτλος</label>
                                <input type="text" id="homeSubtitle" placeholder="π.χ. Α.Ο.">
                            </div>
                        </div>

                        <div class="team-section">
                            <h3>✈️ Φιλοξενούμενος</h3>
                            <div class="form-group">
                                <label>Ομάδα *</label>
                                <select id="awayTeam" required>
                                    <option value="">Επιλέξτε ομάδα...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Υπότιτλος</label>
                                <input type="text" id="awaySubtitle" placeholder="π.χ. Σ.Φ.Π">
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">💾 Αποθήκευση Αγώνα</button>
                        <button type="button" class="btn btn-secondary" id="previewBtn">👁️ Προεπισκόπηση</button>
                        <button type="button" class="btn btn-tertiary" id="downloadBtn">📥 Λήψη Αρχείων</button>
                    </div>
                </div>
            </form>

            <div class="section-title">Διαχείριση Ομάδων</div>
            <div class="teams-list" id="teamsList"></div>
            <button type="button" class="btn btn-secondary" onclick="showAddTeamDialog()" style="margin-bottom: 30px;">+ Προσθήκη Νέας Ομάδας</button>

            <div class="match-history">
                <h2 class="section-title">Ιστορικό Αγώνων</h2>
                <div id="matchHistory"></div>
            </div>
        </div>
    </div>

    <script>
        // Data structure
        const teams = {};
        const matches = {};

        // Initialize with default Greek volleyball teams
        const defaultTeams = [
            { name: 'Παναθηναϊκός', slug: 'panathinaikos', color: '#16a34a', logo: 'panathinaikos.png', subtitle: 'Α.Ο.' },
            { name: 'Ολυμπιακός', slug: 'olympiakos', color: '#dc1414', logo: 'olympiakos.png', subtitle: 'Σ.Φ.Π ΠΕΙΡΑΙΟΣ' },
            { name: 'ΠΑΟΚ', slug: 'paok', color: '#000000', logo: 'paok.png', subtitle: '' },
            { name: 'ΑΕΚ', slug: 'aek', color: '#fbbf24', logo: 'aek.png', subtitle: '' },
            { name: 'Άρης', slug: 'aris', color: '#d81b22', logo: 'aris.png', subtitle: '' },
            { name: 'Φοίνικας Σύρου', slug: 'foinikas', color: '#f97316', logo: 'foinikas.png', subtitle: '' },
            { name: 'Κηφισιά', slug: 'kifisia', color: '#0ea5e9', logo: 'kifisia.png', subtitle: '' },
            { name: 'Μίλων', slug: 'milon', color: '#8b5cf6', logo: 'milon.png', subtitle: '' },
            { name: 'Εθνικός', slug: 'ethnikos', color: '#06b6d4', logo: 'ethnikos.png', subtitle: '' },
            { name: 'Ηρακλής', slug: 'iraklis', color: '#1e40af', logo: 'iraklis.png', subtitle: '' }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            
            // Add default teams if none exist
            if (Object.keys(teams).length === 0) {
                defaultTeams.forEach(team => {
                    teams[team.slug] = team;
                });
                saveToLocalStorage();
            }

            populateTeamSelects();
            displayTeams();
            displayMatchHistory();

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('matchDate').value = today;
        });

        function populateTeamSelects() {
            const homeSelect = document.getElementById('homeTeam');
            const awaySelect = document.getElementById('awayTeam');
            
            homeSelect.innerHTML = '<option value="">Επιλέξτε ομάδα...</option>';
            awaySelect.innerHTML = '<option value="">Επιλέξτε ομάδα...</option>';

            Object.values(teams).forEach(team => {
                const option1 = document.createElement('option');
                option1.value = team.slug;
                option1.textContent = team.name;
                homeSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = team.slug;
                option2.textContent = team.name;
                awaySelect.appendChild(option2);
            });
        }

        function displayTeams() {
            const container = document.getElementById('teamsList');
            container.innerHTML = '';

            Object.values(teams).forEach(team => {
                const card = document.createElement('div');
                card.className = 'team-card';
                card.innerHTML = `
                    <h4>${team.name}</h4>
                    <p style="font-family: monospace; color: #3b82f6;">/${team.slug}</p>
                    <p>Χρώμα: <span style="display: inline-block; width: 20px; height: 20px; background: ${team.color}; border-radius: 4px; vertical-align: middle;"></span></p>
                `;
                container.appendChild(card);
            });
        }

        document.getElementById('matchForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const homeSlug = document.getElementById('homeTeam').value;
            const awaySlug = document.getElementById('awayTeam').value;

            if (homeSlug === awaySlug) {
                alert('Οι ομάδες πρέπει να είναι διαφορετικές!');
                return;
            }

            const matchData = {
                id: Date.now().toString(),
                date: document.getElementById('matchDate').value,
                league: document.getElementById('league').value,
                homeTeam: {
                    ...teams[homeSlug],
                    subtitle: document.getElementById('homeSubtitle').value || teams[homeSlug].subtitle
                },
                awayTeam: {
                    ...teams[awaySlug],
                    subtitle: document.getElementById('awaySubtitle').value || teams[awaySlug].subtitle
                },
                createdAt: new Date().toISOString()
            };

            // Save match
            matches[matchData.id] = matchData;

            // Update team's latest match
            teams[homeSlug].latestMatch = matchData.id;
            teams[awaySlug].latestMatch = matchData.id;

            saveToLocalStorage();
            displayMatchHistory();

            alert(`✅ Αγώνας αποθηκεύτηκε!\n\nΤα URLs ενημερώθηκαν:\n• /${homeSlug}\n• /${awaySlug}`);

            // Reset form
            document.getElementById('matchForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('matchDate').value = today;
        });

        document.getElementById('previewBtn').addEventListener('click', function() {
            const homeSlug = document.getElementById('homeTeam').value;
            const awaySlug = document.getElementById('awayTeam').value;

            if (!homeSlug || !awaySlug) {
                alert('Επιλέξτε και τις δύο ομάδες!');
                return;
            }

            const matchData = {
                homeTeam: {
                    ...teams[homeSlug],
                    subtitle: document.getElementById('homeSubtitle').value || teams[homeSlug].subtitle
                },
                awayTeam: {
                    ...teams[awaySlug],
                    subtitle: document.getElementById('awaySubtitle').value || teams[awaySlug].subtitle
                },
                date: formatGreekDate(new Date(document.getElementById('matchDate').value)),
                league: document.getElementById('league').value
            };

            const params = createURLParams(matchData);
            window.open('intro.html?' + params, '_blank');
        });

        document.getElementById('downloadBtn').addEventListener('click', function() {
            generateAllTeamFiles();
        });

        function generateAllTeamFiles() {
            let filesGenerated = [];

            // Generate a file for each team
            Object.values(teams).forEach(team => {
                const latestMatchId = team.latestMatch;
                
                if (latestMatchId && matches[latestMatchId]) {
                    const match = matches[latestMatchId];
                    const params = createURLParams({
                        homeTeam: match.homeTeam,
                        awayTeam: match.awayTeam,
                        date: formatGreekDate(new Date(match.date)),
                        league: match.league
                    });

                    const htmlContent = `<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="0;url=intro.html?${params}">
    <title>${team.name} - Τελευταίος Αγώνας</title>
</head>
<body>
    <p>Φόρτωση τελευταίου αγώνα για ${team.name}...</p>
</body>
</html>`;

                    downloadFile(`${team.slug}.html`, htmlContent, 'text/html');
                    filesGenerated.push(`${team.slug}.html`);
                }
            });

            // Generate teams.json with all team data
            const teamsData = {};
            Object.values(teams).forEach(team => {
                if (team.latestMatch && matches[team.latestMatch]) {
                    teamsData[team.slug] = {
                        name: team.name,
                        color: team.color,
                        logo: team.logo,
                        subtitle: team.subtitle,
                        latestMatch: matches[team.latestMatch]
                    };
                }
            });

            const jsonContent = JSON.stringify(teamsData, null, 2);
            downloadFile('teams.json', jsonContent, 'application/json');
            filesGenerated.push('teams.json');

            alert(`✅ Αρχεία κατέβηκαν!\n\n${filesGenerated.join('\n')}\n\nΑνεβάστε τα στο GitHub repository σας.`);
        }

        function createURLParams(matchData) {
            const params = new URLSearchParams({
                homeName: matchData.homeTeam.name,
                homeSubtitle: matchData.homeTeam.subtitle,
                homeColor: matchData.homeTeam.color,
                homeLogo: matchData.homeTeam.logo,
                awayName: matchData.awayTeam.name,
                awaySubtitle: matchData.awayTeam.subtitle,
                awayColor: matchData.awayTeam.color,
                awayLogo: matchData.awayTeam.logo,
                date: matchData.date,
                league: matchData.league
            });
            return params.toString();
        }

        function formatGreekDate(date) {
            const months = ['Ιανουαρίου', 'Φεβρουαρίου', 'Μαρτίου', 'Απριλίου', 'Μαΐου', 'Ιουνίου',
                          'Ιουλίου', 'Αυγούστου', 'Σεπτεμβρίου', 'Οκτωβρίου', 'Νοεμβρίου', 'Δεκεμβρίου'];
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
        }

        function displayMatchHistory() {
            const container = document.getElementById('matchHistory');
            container.innerHTML = '';

            const matchArray = Object.values(matches).sort((a, b) => 
                new Date(b.createdAt) - new Date(a.createdAt)
            );

            if (matchArray.length === 0) {
                container.innerHTML = '<p style="color: #64748b; text-align: center;">Δεν υπάρχουν αγώνες</p>';
                return;
            }

            matchArray.forEach(match => {
                const item = document.createElement('div');
                item.className = 'match-item';
                item.innerHTML = `
                    <h4>${match.homeTeam.name} vs ${match.awayTeam.name}</h4>
                    <div class="match-meta">
                        📅 ${new Date(match.date).toLocaleDateString('el-GR')} | 🏆 ${match.league}
                    </div>
                    <p style="font-size: 12px; color: #94a3b8;">Δημιουργήθηκε: ${new Date(match.createdAt).toLocaleString('el-GR')}</p>
                    <div class="match-actions">
                        <button class="btn-view" onclick="previewMatch('${match.id}')">Προβολή</button>
                        <button class="btn-delete" onclick="deleteMatch('${match.id}')">Διαγραφή</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function previewMatch(matchId) {
            const match = matches[matchId];
            const params = createURLParams({
                homeTeam: match.homeTeam,
                awayTeam: match.awayTeam,
                date: formatGreekDate(new Date(match.date)),
                league: match.league
            });
            window.open('intro.html?' + params, '_blank');
        }

        function deleteMatch(matchId) {
            if (confirm('Είστε σίγουροι ότι θέλετε να διαγράψετε αυτόν τον αγώνα;')) {
                delete matches[matchId];
                
                // Update teams' latest match references
                Object.values(teams).forEach(team => {
                    if (team.latestMatch === matchId) {
                        team.latestMatch = null;
                    }
                });

                saveToLocalStorage();
                displayMatchHistory();
            }
        }

        function showAddTeamDialog() {
            const name = prompt('Όνομα ομάδας:');
            if (!name) return;

            const slug = generateSlug(name);
            const color = prompt('Χρώμα (hex):', '#3b82f6');
            const logo = prompt('Logo filename:', `${slug}.png`);

            teams[slug] = {
                name: name,
                slug: slug,
                color: color,
                logo: logo,
                subtitle: '',
                latestMatch: null
            };

            saveToLocalStorage();
            populateTeamSelects();
            displayTeams();
            alert(`✅ Η ομάδα "${name}" προστέθηκε!`);
        }

        function generateSlug(text) {
            return text.toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }

        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function saveToLocalStorage() {
            localStorage.setItem('volleyballTeams', JSON.stringify(teams));
            localStorage.setItem('volleyballMatches', JSON.stringify(matches));
        }

        function loadFromLocalStorage() {
            const savedTeams = localStorage.getItem('volleyballTeams');
            const savedMatches = localStorage.getItem('volleyballMatches');

            if (savedTeams) Object.assign(teams, JSON.parse(savedTeams));
            if (savedMatches) Object.assign(matches, JSON.parse(savedMatches));
        }
    </script>
</body>
</html>
