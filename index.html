<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volleyball Match Manager - Auto GitHub Sync</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .content {
            padding: 40px;
        }

        .github-setup {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .github-setup h3 {
            color: #92400e;
            margin-bottom: 15px;
        }

        .github-setup.configured {
            background: #d1fae5;
            border-left-color: #10b981;
        }

        .github-setup.configured h3 {
            color: #065f46;
        }

        .setup-form {
            display: grid;
            gap: 15px;
            margin-top: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #334155;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input[type="text"],
        .form-group input[type="password"],
        .form-group input[type="date"],
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .section-title {
            font-size: 24px;
            color: #1e3a8a;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3b82f6;
        }

        .match-form {
            background: #f8fafc;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
            margin-bottom: 30px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .team-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .team-section h3 {
            color: #1e3a8a;
            margin-bottom: 15px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .status-message.success {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }

        .status-message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }

        .status-message.info {
            background: #dbeafe;
            color: #1e40af;
            border: 2px solid #3b82f6;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .help-text {
            font-size: 13px;
            color: #64748b;
            margin-top: 5px;
        }

        .match-history {
            margin-top: 40px;
        }

        .match-item {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e2e8f0;
        }

        .match-item h4 {
            color: #1e3a8a;
            margin-bottom: 10px;
        }

        .match-meta {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .sync-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 5px;
        }

        .sync-badge.synced {
            background: #d1fae5;
            color: #065f46;
        }

        .sync-badge.pending {
            background: #fef3c7;
            color: #92400e;
        }

        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ Auto-Sync Match Manager</h1>
            <p>Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î±Î³ÏÎ½ÎµÏ‚ ÎºÎ±Î¹ Î±Î½ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÏƒÏ„Î¿ GitHub!</p>
        </div>

        <div class="content">
            <!-- GitHub Setup -->
            <div class="github-setup" id="githubSetup">
                <h3>âš™ï¸ GitHub Configuration</h3>
                <p>Î“Î¹Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÏƒÏ„Î¿ GitHub, Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ Î­Î½Î± Personal Access Token.</p>
                
                <div class="setup-form">
                    <div class="form-group">
                        <label>GitHub Username *</label>
                        <input type="text" id="githubUsername" placeholder="volleyleaguecupgr">
                        <div class="help-text">Î¤Î¿ username ÏƒÎ±Ï‚ ÏƒÏ„Î¿ GitHub</div>
                    </div>
                    <div class="form-group">
                        <label>Repository Name *</label>
                        <input type="text" id="githubRepo" placeholder="intro">
                        <div class="help-text">Î¤Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… repository</div>
                    </div>
                    <div class="form-group">
                        <label>Personal Access Token *</label>
                        <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                        <div class="help-text">
                            <a href="https://github.com/settings/tokens/new?scopes=repo&description=Volleyball%20Match%20Manager" target="_blank" style="color: #3b82f6;">
                                Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ token ÎµÎ´Ï
                            </a> (Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ repo access)
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="saveGitHubConfig()">ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î¡Ï…Î¸Î¼Î¯ÏƒÎµÏ‰Î½</button>
                </div>
            </div>

            <div class="status-message" id="statusMessage"></div>

            <!-- Match Creation Form -->
            <div class="section-title">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎÎ­Î¿Ï… Î‘Î³ÏÎ½Î±</div>

            <form id="matchForm">
                <div class="match-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î‘Î³ÏÎ½Î± *</label>
                            <input type="date" id="matchDate" required>
                        </div>
                        <div class="form-group">
                            <label>Î‘Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÎ® *</label>
                            <input type="text" id="league" value="Î· Î‘Î“Î©ÎÎ™Î£Î¤Î™ÎšÎ—" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="team-section">
                            <h3>ğŸ  Î“Î·Ï€ÎµÎ´Î¿ÏÏ‡Î¿Ï‚</h3>
                            <div class="form-group">
                                <label>ÎŸÎ¼Î¬Î´Î± *</label>
                                <select id="homeTeam" required>
                                    <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¿Î¼Î¬Î´Î±...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <!-- <label>Î¥Ï€ÏŒÏ„Î¹Ï„Î»Î¿Ï‚</label>
                                <input type="text" id="homeSubtitle" placeholder="Ï€.Ï‡. Î‘.ÎŸ."> -->
                            </div>
                        </div>

                        <div class="team-section">
                            <h3>âœˆï¸ Î¦Î¹Î»Î¿Î¾ÎµÎ½Î¿ÏÎ¼ÎµÎ½Î¿Ï‚</h3>
                            <div class="form-group">
                                <label>ÎŸÎ¼Î¬Î´Î± *</label>
                                <select id="awayTeam" required>
                                    <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¿Î¼Î¬Î´Î±...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <!-- <label>Î¥Ï€ÏŒÏ„Î¹Ï„Î»Î¿Ï‚</label>
                                <input type="text" id="awaySubtitle" placeholder="Ï€.Ï‡. Î£.Î¦.Î "> -->
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-primary" id="saveBtn">
                            ğŸš€ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· & Auto-Upload
                        </button>
                        <button type="button" class="btn btn-secondary" id="previewBtn">
                            ğŸ‘ï¸ Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ·
                        </button>
                        <button type="button" class="btn btn-warning" id="manualDownloadBtn">
                            ğŸ“¥ ÎœÎ·-Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î›Î®ÏˆÎ·
                        </button>
                    </div>
                </div>
            </form>

            <!-- Match History -->
            <div class="match-history">
                <h2 class="section-title">Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Î‘Î³ÏÎ½Ï‰Î½</h2>
                <div id="matchHistory"></div>
            </div>
        </div>
    </div>

    <script>
        // Data structures
        const teams = {};
        const matches = {};
        let githubConfig = null;

        // Default teams
        const defaultTeams = [
            { name: 'Î Î±Î½Î±Î¸Î·Î½Î±ÏŠÎºÏŒÏ‚', slug: 'panathinaikos', color: '#16a34a', logo: 'panathinaikos.png', subtitle: 'Î‘.ÎŸ.' },
            { name: 'ÎŸÎ»Ï…Î¼Ï€Î¹Î±ÎºÏŒÏ‚', slug: 'olympiakos', color: '#dc1414', logo: 'olympiakos.png', subtitle: 'Î£.Î¦.Î  ÎŸÎÎ•Î§' },
            { name: 'Î .Î‘.ÎŸ.Îš.', slug: 'paok', color: '#000000', logo: 'paok.png', subtitle: 'Î‘.Î£.' },
            { name: 'ÎšÎ±Î»Î±Î¼Î¬Ï„Î±', slug: 'kalamata', color: '#008428', logo: 'kalamata.png', subtitle: 'A.O. '80' },
            { name: 'Î¦Î»Î¿Î¯ÏƒÎ²Î¿Ï‚', slug: 'floisvos', color: '#3a55a8', logo: 'floisvos.png', subtitle: 'A. O.' },
            { name: 'Î¦Î¿Î¯Î½Î¹ÎºÎ±Ï‚ Î£ÏÏÎ¿Ï…', slug: 'foinikas', color: '#2e3192', logo: 'foinikas.png', subtitle: 'A.O.' },
            { name: 'ÎšÎ·Ï†Î¹ÏƒÎ¹Î¬', slug: 'kifisia', color: '#283980', logo: 'kifisia.png', subtitle: 'A.ÎŸ.Î .Î£.' },
            { name: 'ÎœÎ¯Î»Ï‰Î½', slug: 'milon', color: '#00772b', logo: 'milon.png', subtitle: 'Î‘.ÎŸ.Î.Î£' },
            { name: 'ÎŸ.Î¦.Î—.', slug: 'ofi', color: '#000000', logo: 'ofi.png', subtitle: '.' },
            { name: 'Î Î±Î½Î¹ÏÎ½Î¹Î¿Ï‚', slug: 'panionios', color: '#db1921', logo: 'panionios.png', subtitle: 'Î“.Î£.Î£.' }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            
            if (Object.keys(teams).length === 0) {
                defaultTeams.forEach(team => {
                    teams[team.slug] = team;
                });
                saveToLocalStorage();
            }

            populateTeamSelects();
            displayMatchHistory();

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('matchDate').value = today;

            // Check if GitHub is configured
            if (githubConfig) {
                updateGitHubStatus(true);
            }
        });

        function saveGitHubConfig() {
            const username = document.getElementById('githubUsername').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            const token = document.getElementById('githubToken').value.trim();

            if (!username || !repo || !token) {
                showStatus('error', 'Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ»Î± Ï„Î± Ï€ÎµÎ´Î¯Î±!');
                return;
            }

            githubConfig = { username, repo, token };
            localStorage.setItem('githubConfig', JSON.stringify(githubConfig));
            
            updateGitHubStatus(true);
            showStatus('success', 'âœ… ÎŸÎ¹ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ GitHub Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½! ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Ï„ÏÏÎ± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Îµ Î±Î³ÏÎ½ÎµÏ‚.');
        }

        function updateGitHubStatus(isConfigured) {
            const setupBox = document.getElementById('githubSetup');
            if (isConfigured) {
                setupBox.classList.add('configured');
                setupBox.querySelector('h3').textContent = 'âœ… GitHub Configured';
                setupBox.querySelector('p').textContent = `Î£Ï…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿ Î¼Îµ: ${githubConfig.username}/${githubConfig.repo}`;
            }
        }

        function populateTeamSelects() {
            const homeSelect = document.getElementById('homeTeam');
            const awaySelect = document.getElementById('awayTeam');
            
            homeSelect.innerHTML = '<option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¿Î¼Î¬Î´Î±...</option>';
            awaySelect.innerHTML = '<option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¿Î¼Î¬Î´Î±...</option>';

            Object.values(teams).forEach(team => {
                const option1 = document.createElement('option');
                option1.value = team.slug;
                option1.textContent = team.name;
                homeSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = team.slug;
                option2.textContent = team.name;
                awaySelect.appendChild(option2);
            });
        }

        /*document.getElementById('matchForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const homeSlug = document.getElementById('homeTeam').value;
            const awaySlug = document.getElementById('awayTeam').value;

            if (homeSlug === awaySlug) {
                showStatus('error', 'ÎŸÎ¹ Î¿Î¼Î¬Î´ÎµÏ‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚!');
                return;
            }

            if (!githubConfig) {
                showStatus('error', 'Î Î±ÏÎ±ÎºÎ±Î»Ï ÏÏ…Î¸Î¼Î¯ÏƒÏ„Îµ Ï„Î¿ GitHub Ï€ÏÏÏ„Î±!');
                return;
            }

            const matchData = createMatchData(homeSlug, awaySlug);

            // Save locally first
            matches[matchData.id] = matchData;
            teams[homeSlug].latestMatch = matchData.id;
            teams[awaySlug].latestMatch = matchData.id;
            saveToLocalStorage();

            // Upload to GitHub
            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = 'â³ Î‘Î½Î­Î²Î±ÏƒÎ¼Î± ÏƒÏ„Î¿ GitHub...<span class="spinner"></span>';

            try {
                await uploadMatchToGitHub(homeSlug, awaySlug, matchData);
                showStatus('success', `âœ… Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î±! ÎŸ Î±Î³ÏÎ½Î±Ï‚ Î±Î½Î­Î²Î·ÎºÎµ ÏƒÏ„Î¿ GitHub.\n\nURLs ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎ±Î½:\nâ€¢ /${homeSlug}\nâ€¢ /${awaySlug}`);
                matchData.synced = true;
                displayMatchHistory();
            } catch (error) {
                showStatus('error', `âŒ Î£Ï†Î¬Î»Î¼Î±: ${error.message}\n\nÎŸ Î±Î³ÏÎ½Î±Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ Ï„Î¿Ï€Î¹ÎºÎ¬. Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ Î® ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Î¼Î·-Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±.`);
                matchData.synced = false;
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = 'ğŸš€ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· & Auto-Upload';
            }

            // Reset form
            document.getElementById('matchForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('matchDate').value = today;
        });*/

        document.getElementById('matchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
        
            const homeSlug = document.getElementById('homeTeam').value;
            const awaySlug = document.getElementById('awayTeam').value;
            const saveBtn = document.getElementById('saveBtn');
        
            if (homeSlug === awaySlug) {
                showStatus('error', 'ÎŸÎ¹ Î¿Î¼Î¬Î´ÎµÏ‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚!');
                return;
            }
        
            if (!githubConfig) {
                showStatus('error', 'Î Î±ÏÎ±ÎºÎ±Î»Ï ÏÏ…Î¸Î¼Î¯ÏƒÏ„Îµ Ï„Î¿ GitHub Ï€ÏÏÏ„Î±!');
                return;
            }
        
            const matchData = createMatchData(homeSlug, awaySlug);
        
            // Save locally first
            matches[matchData.id] = matchData;
            teams[homeSlug].latestMatch = matchData.id;
            teams[awaySlug].latestMatch = matchData.id;
            saveToLocalStorage();
        
            // UI lock during upload
            saveBtn.disabled = true;
            saveBtn.innerHTML = 'â³ Î‘Î½Î­Î²Î±ÏƒÎ¼Î± ÏƒÏ„Î¿ GitHub...<span class="spinner"></span>';
        
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.style.display = 'block';
            statusMessage.className = 'status-message info';
            statusMessage.textContent = 'â³ Î“Î¯Î½ÎµÏ„Î±Î¹ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® ÏƒÏ„Î¿ GitHub... ÎœÎ·Î½ ÎºÎ¬Î½ÎµÏ„Îµ Î¬Î»Î»Î· Ï…Ï€Î¿Î²Î¿Î»Î®.';
        
            try {
                await uploadMatchToGitHub(homeSlug, awaySlug, matchData);
                matchData.synced = true;
                displayMatchHistory();
        
                // âœ… Success
                let cooldown = 5;
                statusMessage.className = 'status-message success';
                statusMessage.textContent = `âœ… Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®! Î‘Î½Î±Î¼Î¿Î½Î® ${cooldown}s Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Î½Î­Î± Ï…Ï€Î¿Î²Î¿Î»Î®...`;
        
                const countdown = setInterval(() => {
                    cooldown--;
                    if (cooldown > 0) {
                        statusMessage.textContent = `âœ… Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®! ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ Î½Î­Î± Ï…Ï€Î¿Î²Î¿Î»Î® ÏƒÎµ ${cooldown}s...`;
                    } else {
                        clearInterval(countdown);
                        statusMessage.style.display = 'none';
                        saveBtn.disabled = false;
                        saveBtn.innerHTML = 'ğŸš€ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· & Auto-Upload';
                    }
                }, 1000);
        
            } catch (error) {
                matchData.synced = false;
                showStatus('error', `âŒ Î£Ï†Î¬Î»Î¼Î±: ${error.message}\n\nÎŸ Î±Î³ÏÎ½Î±Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ Ï„Î¿Ï€Î¹ÎºÎ¬. Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ Î® ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Î¼Î·-Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±.`);
                saveBtn.disabled = false;
                saveBtn.innerHTML = 'ğŸš€ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· & Auto-Upload';
            }
        
            // Reset form after submission
            document.getElementById('matchForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('matchDate').value = today;
        });


        function createMatchData(homeSlug, awaySlug) {
            return {
                id: Date.now().toString(),
                date: document.getElementById('matchDate').value,
                league: document.getElementById('league').value,
                homeTeam: {
                    ...teams[homeSlug],
                    subtitle: document.getElementById('homeSubtitle').value || teams[homeSlug].subtitle
                },
                awayTeam: {
                    ...teams[awaySlug],
                    subtitle: document.getElementById('awaySubtitle').value || teams[awaySlug].subtitle
                },
                createdAt: new Date().toISOString(),
                synced: false
            };
        }

        async function uploadMatchToGitHub(homeSlug, awaySlug, matchData) {
            const { username, repo, token } = githubConfig;
            const branch = 'main'; // or change to 'data' if you prefer a separate branch

            const jsonData = {
                homeTeam: matchData.homeTeam,
                awayTeam: matchData.awayTeam,
                date: formatGreekDate(new Date(matchData.date)),
                league: matchData.league
            };

            const homePath = `teams/${homeSlug}.json`;
            const awayPath = `teams/${awaySlug}.json`;

            // Step 1: Get latest commit SHA for the branch
            const branchInfo = await ghGet(`repos/${username}/${repo}/git/ref/heads/${branch}`, token);
            const latestCommitSha = branchInfo.object.sha;

            // Step 2: Get the tree of the latest commit
            const commitInfo = await ghGet(`repos/${username}/${repo}/git/commits/${latestCommitSha}`, token);
            const baseTreeSha = commitInfo.tree.sha;

            // Step 3: Create blobs for both JSON files
            const homeBlob = await ghPost(`repos/${username}/${repo}/git/blobs`, token, {
                content: JSON.stringify(jsonData, null, 2),
                encoding: 'utf-8'
            });
            const awayBlob = await ghPost(`repos/${username}/${repo}/git/blobs`, token, {
                content: JSON.stringify(jsonData, null, 2),
                encoding: 'utf-8'
            });

            // Step 4: Create a new tree referencing the new blobs
            const newTree = await ghPost(`repos/${username}/${repo}/git/trees`, token, {
                base_tree: baseTreeSha,
                tree: [
                    { path: homePath, mode: '100644', type: 'blob', sha: homeBlob.sha },
                    { path: awayPath, mode: '100644', type: 'blob', sha: awayBlob.sha }
                ]
            });

            // Step 5: Create a single commit
            const newCommit = await ghPost(`repos/${username}/${repo}/git/commits`, token, {
                message: `Update match data for ${homeSlug} vs ${awaySlug}`,
                tree: newTree.sha,
                parents: [latestCommitSha]
            });

            // Step 6: Update branch reference
            await ghPatch(`repos/${username}/${repo}/git/refs/heads/${branch}`, token, {
                sha: newCommit.sha
            });
        }

        /*async function ghGet(endpoint, token) {
            const res = await fetch(`https://api.github.com/${endpoint}`, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            if (!res.ok) throw new Error(`GET ${endpoint} failed: ${res.statusText}`);
            return res.json();
        }*/
        async function ghGet(endpoint, token, retries = 3) {
            for (let i = 0; i < retries; i++) {
                const res = await fetch(`https://api.github.com/${endpoint}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                if (res.ok) return res.json();
        
                if (res.status === 404 && i < retries - 1) {
                    console.warn(`Retrying ${endpoint}...`);
                    await new Promise(r => setTimeout(r, 2000));
                    continue;
                }
        
                throw new Error(`GET ${endpoint} failed: ${res.statusText}`);
            }
        }


        async function ghPost(endpoint, token, body) {
            const res = await fetch(`https://api.github.com/${endpoint}`, {
                method: 'POST',
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });
            if (!res.ok) throw new Error(`POST ${endpoint} failed: ${res.statusText}`);
            return res.json();
        }

        async function ghPatch(endpoint, token, body) {
            const res = await fetch(`https://api.github.com/${endpoint}`, {
                method: 'PATCH',
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });
            if (!res.ok) throw new Error(`PATCH ${endpoint} failed: ${res.statusText}`);
            return res.json();
        }


        async function uploadFileToGitHub(username, repo, token, path, content, message) {
            const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;
            
            // First, try to get the file to see if it exists (need SHA for update)
            let sha = null;
            try {
                const getResponse = await fetch(apiUrl, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (getResponse.ok) {
                    const data = await getResponse.json();
                    sha = data.sha;
                }
            } catch (e) {
                // File doesn't exist, that's OK
            }

            // Now create or update the file
            const body = {
                message: message,
                content: btoa(unescape(encodeURIComponent(content))), // Base64 encode
                branch: 'main'
            };

            if (sha) {
                body.sha = sha; // Required for updates
            }

            const response = await fetch(apiUrl, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || 'GitHub API error');
            }

            return await response.json();
        }

        document.getElementById('previewBtn').addEventListener('click', function() {
            const homeSlug = document.getElementById('homeTeam').value;
            const awaySlug = document.getElementById('awayTeam').value;

            if (!homeSlug || !awaySlug) {
                showStatus('error', 'Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Î¹ Ï„Î¹Ï‚ Î´ÏÎ¿ Î¿Î¼Î¬Î´ÎµÏ‚!');
                return;
            }

            const matchData = createMatchData(homeSlug, awaySlug);
            const params = createURLParams(matchData);
            window.open('intro.html?' + params, '_blank');
        });

        document.getElementById('manualDownloadBtn').addEventListener('click', function() {
            const homeSlug = document.getElementById('homeTeam').value;
            const awaySlug = document.getElementById('awayTeam').value;

            if (!homeSlug || !awaySlug) {
                showStatus('error', 'Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Î¹ Ï„Î¹Ï‚ Î´ÏÎ¿ Î¿Î¼Î¬Î´ÎµÏ‚!');
                return;
            }

            const matchData = createMatchData(homeSlug, awaySlug);
            
            const jsonData = {
                homeTeam: matchData.homeTeam,
                awayTeam: matchData.awayTeam,
                date: formatGreekDate(new Date(matchData.date)),
                league: matchData.league
            };

            downloadFile(`${homeSlug}.json`, JSON.stringify(jsonData, null, 2), 'application/json');
            downloadFile(`${awaySlug}.json`, JSON.stringify(jsonData, null, 2), 'application/json');

            showStatus('success', `âœ… Î‘ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î­Î²Î·ÎºÎ±Î½!\n\nÎ‘Î½ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î± Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î± ÏƒÏ„Î¿ teams/ folder.`);
        });

        function createURLParams(matchData) {
            const params = new URLSearchParams({
                homeName: matchData.homeTeam.name,
                homeSubtitle: matchData.homeTeam.subtitle,
                homeColor: matchData.homeTeam.color,
                homeLogo: matchData.homeTeam.logo,
                awayName: matchData.awayTeam.name,
                awaySubtitle: matchData.awayTeam.subtitle,
                awayColor: matchData.awayTeam.color,
                awayLogo: matchData.awayTeam.logo,
                date: formatGreekDate(new Date(matchData.date)),
                league: matchData.league
            });
            return params.toString();
        }

        function formatGreekDate(date) {
            const months = ['Î™Î±Î½Î¿Ï…Î±ÏÎ¯Î¿Ï…', 'Î¦ÎµÎ²ÏÎ¿Ï…Î±ÏÎ¯Î¿Ï…', 'ÎœÎ±ÏÏ„Î¯Î¿Ï…', 'Î‘Ï€ÏÎ¹Î»Î¯Î¿Ï…', 'ÎœÎ±ÎÎ¿Ï…', 'Î™Î¿Ï…Î½Î¯Î¿Ï…',
                          'Î™Î¿Ï…Î»Î¯Î¿Ï…', 'Î‘Ï…Î³Î¿ÏÏƒÏ„Î¿Ï…', 'Î£ÎµÏ€Ï„ÎµÎ¼Î²ÏÎ¯Î¿Ï…', 'ÎŸÎºÏ„Ï‰Î²ÏÎ¯Î¿Ï…', 'ÎÎ¿ÎµÎ¼Î²ÏÎ¯Î¿Ï…', 'Î”ÎµÎºÎµÎ¼Î²ÏÎ¯Î¿Ï…'];
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
        }

        function displayMatchHistory() {
            const container = document.getElementById('matchHistory');
            container.innerHTML = '';

            const matchArray = Object.values(matches).sort((a, b) => 
                new Date(b.createdAt) - new Date(a.createdAt)
            );

            if (matchArray.length === 0) {
                container.innerHTML = '<p style="color: #64748b; text-align: center;">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±Î³ÏÎ½ÎµÏ‚</p>';
                return;
            }

            matchArray.forEach(match => {
                const syncBadge = match.synced 
                    ? '<span class="sync-badge synced">âœ“ Synced to GitHub</span>'
                    : '<span class="sync-badge pending">â³ Local only</span>';

                const item = document.createElement('div');
                item.className = 'match-item';
                item.innerHTML = `
                    <h4>${match.homeTeam.name} vs ${match.awayTeam.name}</h4>
                    <div class="match-meta">
                        ğŸ“… ${new Date(match.date).toLocaleDateString('el-GR')} | ğŸ† ${match.league}
                    </div>
                    ${syncBadge}
                `;
                container.appendChild(item);
            });
        }

        function showStatus(type, message) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.className = `status-message ${type}`;
            statusEl.textContent = message;
            statusEl.style.display = 'block';

            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 8000);
        }

        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function saveToLocalStorage() {
            localStorage.setItem('volleyballTeams', JSON.stringify(teams));
            localStorage.setItem('volleyballMatches', JSON.stringify(matches));
        }

        function loadFromLocalStorage() {
            const savedTeams = localStorage.getItem('volleyballTeams');
            const savedMatches = localStorage.getItem('volleyballMatches');
            const savedGitHub = localStorage.getItem('githubConfig');

            if (savedTeams) Object.assign(teams, JSON.parse(savedTeams));
            if (savedMatches) Object.assign(matches, JSON.parse(savedMatches));
            if (savedGitHub) {
                githubConfig = JSON.parse(savedGitHub);
                document.getElementById('githubUsername').value = githubConfig.username;
                document.getElementById('githubRepo').value = githubConfig.repo;
                document.getElementById('githubToken').value = githubConfig.token;
            }
        }
    </script>
</body>
</html>
